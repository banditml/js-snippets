window.refinery=window.refinery||{},refinery.RefineryAPI=function(e={}){this.storage=window.localStorage,this.refineryAppToken=this.getAppTokenFromScriptTag();this.config=Object.assign({debugMode:!1,refineryHostUrl:"https://app.banditml.com/api/v2/"},e),this.refineryLiveRefinementEndpoint=`${this.config.refineryHostUrl}changesets`},refinery.RefineryAPI.prototype.getAppTokenFromScriptTag=function(){return document.currentScript.getAttribute("appToken")},refinery.RefineryAPI.prototype.asyncGetRequest=async function(e,n={},t={}){n&&Object.keys(n).length&&(e+="?");for(const t in n){let r=n[t];if(null!=t&&null!=r){const n=typeof r;let i;e+=`${t}=${i="number"===n||"string"===n?r:encodeURIComponent(JSON.stringify(r))}&`}}const r=await fetch(e,{method:"GET",headers:t});return await r.json()},refinery.RefineryAPI.prototype.getLiveRefinement=function(){return this.asyncGetRequest(url=this.refineryLiveRefinementEndpoint,params={},headers={"x-app-token":`${this.refineryAppToken}`}).then(e=>e.results).catch(e=>{console.error("Failed to fetch changes",e)})},refinery.RefineryAPI.prototype.applyChange=function(e){if(window.location.href===e.href){let n=document.querySelector(e.domPath);n.innerHTML.trim()!==e.beforeHtml.trim()?console.warn(`Can't apply change on '${e.beforeHtml}' because copy doesn't match.'${e.beforeHtml.trim()}' vs. '${n.innerHTML.trim()}'.`):(console.log(e.afterHtml),n.innerHTML=e.afterHtml)}else console.warn(`\n      Can't apply change on '${e.beforeHtml}' because href's don't match.'${e.href}' vs. '${window.location.href}'.`)},refinery.RefineryAPI.prototype.applyChanges=function(){const e=this;e.getLiveRefinement().then(n=>{let t,r=n[0];(t=r.publish?r.changes:[]).filter(e=>!e.deleted).forEach(n=>{e.applyChange(n)})})};let refineryAPI=new refinery.RefineryAPI;refineryAPI.applyChanges();
