<!DOCTYPE HTML>
<html>
<head>
<title>Your Cart</title>
<link rel="stylesheet" href={{url_for('static', filename='css/cart.css')}} />
<link rel="stylesheet" href={{url_for('static', filename='css/topStyle.css') }} />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
{#<script type="text/javascript" src="https://d10t8xi8ymznsy.cloudfront.net/banditMl.min.js"></script>#}
<script src={{ url_for('static', filename='js/banditMl.min.js') }}></script>
<script src={{ url_for('static', filename='js/banditLocal.js') }}></script>
</head>
<body>
<div id="title">
	<form>
		<input id="searchBox" type="text" name="searchQuery">
		<input id="searchButton" type="submit" value="Search">
	</form>

	{% if not loggedIn %}
		<div id="signInButton">
			<a class="link" href="/loginForm">Sign In</a>
		</div>
	{% else %}
	<div class="dropdown">
		<button class="dropbtn">Hello, <br>{{firstName}}</button>
		<div class="dropdown-content">
			<a href="/account/orders">Your orders</a>
			<a href="/account/profile">Your profile</a>
			<hr>
			<a href="/logout">Sign Out</a>
		</div>
	</div>
	{% endif %}
	<div id="kart">
		<a class="link" href="/cart">
		<img src={{url_for('static', filename='images/shoppingCart.png')}} id="cartIcon" />
		CART {{noOfItems}}
		</a>
	</div>
</div>
<div id="cartItems">
	<h2>Shopping Cart</h2>
	<div id="tableItems">
		{% for row in products %}
		<div>
			<hr id="seperator">
			<div id="itemImage">
				<img src={{url_for('static', filename='uploads/'+row[3])}} id="image"/>
			</div>
			<div id="itemName">
				<span id="itemNameTag">{{row[1]}}</span><br>
				In stock<br>
				<a href="/removeFromCart?productId={{row[0]}}">Remove</a>
			</div>
			<div id="itemPrice">
				Rs {{row[2]}}
			</div>
		</div>
		{% endfor %}
		<hr id="seperator">
		<div id="total">
			<span id="subtotal">Subtotal</span> : Rs {{totalPrice}}
			<script>
        {#bandit.updateContext({productsInCart: ["b", "a"]}, experimentId);#}
        bandit.updateContext({totalCartValue: {{totalPrice}}}, experimentId);
        bandit.updateContext({currentlyViewingProduct: "prod_Kvg9l6xado1bB7"}, experimentId);
        {#bandit.updateContext({currentlyViewingProduct: "prod_Kvg9l6xBbo1bB7"}, experimentId);#}
      </script>
		</div>
	</div>
</div>
<a href="#" onclick="bandit.logReward({prod_RyWOwmE39wnEa2: 20}, experimentId);">Proceed to checkout</a>
<br>
<div>
	<h2>Bandit ML debug logs:</h2>
		<h3>Context: </h3><p id="contextDiv"></p>
		<h3>Decision: </h3><p id="decisionDiv"></p>
  <div class="recs" id="recs">
    <h2> Bandit ML Product Recommendation:</h2>
    <h3>You should also buy: </h3><p id="recommendationDiv"></p>
  </div>
</div>
<style>
  .recs {
    margin-top: 1500px;
    margin-bottom: 300px;
  }
</style>
</body>
</html>

<script>
	var context = bandit.getContext(experimentId);
  var decision = 4;
  async function getProductRecs() {
    return ["prod_Kvg9l6xado1bB7", "prod_NXELwjqnzl3A4p", "prod_0YnEoqpxpwe7P6"];
  }

  function filterRecs(recs) {
    return recs.slice(0, 3);
  }

  async function modHtml(recs) {
    document.getElementById("recommendationDiv").innerHTML = JSON.stringify(recs);
    return recs;
  }
	bandit.getDecision(
    experimentId,
    defaultProductRecs = getProductRecs,
    filterRecs = filterRecs,
    populateProductRecs = modHtml
  );
	document.getElementById("contextDiv").innerHTML = JSON.stringify(context);

	$.ajax({
	  url: 'get_product?productId=' + decision,
	  success: function(data) {
	    $('.recommendationDiv').html(JSON.stringify(data));
	  }
	});
</script>
