<!DOCTYPE HTML>
<html>
<head>
<title>Your Cart</title>
<link rel="stylesheet" href={{url_for('static', filename='css/cart.css')}} />
<link rel="stylesheet" href={{url_for('static', filename='css/topStyle.css') }} />

<script>
class BanditAPI {
    constructor() {
        this.contextName = "banditMLContext";
				this.storage = window.localStorage;
    }

		getContext() {
				return JSON.parse(this.storage.getItem(this.contextName));
		}

		setContext(dict) {
				this.storage.setItem(this.contextName, JSON.stringify(dict));
		}

		clearContext() {
				this.storage.removeItem(this.contextName);
		}

		updateContext(dict) {
		    var context = this.getContext();
				if (context == null) {
				    context = dict;
				} else {
					context = Object.assign({}, context, dict);
				}
				this.setContext(context);
		}

		getDecision(experimentId) {
		    // make ajax? call to gradient-app
				// how to know which experiment?
				return {
				    id: "abc123", // to join reward on
						decision: [
						    "VPN",
								"Easy WP",
								"SSL"
						]
				}
		}

		logReward(decisionId, reward) {
		    // make ajax? call to gradient-app
				console.log(this.getContext(), decisionId, reward);
		}
}

var bandit = new BanditAPI()
</script>

</head>
<body>
<div id="title">
	<form>
		<input id="searchBox" type="text" name="searchQuery">
		<input id="searchButton" type="submit" value="Search">
	</form>

	{% if not loggedIn %}
		<div id="signInButton">
			<a class="link" href="/loginForm">Sign In</a>
		</div>
	{% else %}
	<div class="dropdown">
		<button class="dropbtn">Hello, <br>{{firstName}}</button>
		<div class="dropdown-content">
			<a href="/account/orders">Your orders</a>
			<a href="/account/profile">Your profile</a>
			<hr>
			<a href="/logout">Sign Out</a>
		</div>
	</div>
	{% endif %}
	<div id="kart">
		<a class="link" href="/cart">
		<img src={{url_for('static', filename='images/shoppingCart.png')}} id="cartIcon" />
		CART {{noOfItems}}
		</a>
	</div>
</div>
<div id="cartItems">
	<h2>Shopping Cart</h2>
	<div id="tableItems">
		{% for row in products %}
		<div>
			<hr id="seperator">
			<div id="itemImage">
				<img src={{url_for('static', filename='uploads/'+row[3])}} id="image"/>
				<script>
					bandit.updateContext({['addedProductId'.concat('{{row[0]}}')]: 1});
				</script>
			</div>
			<div id="itemName">
				<span id="itemNameTag">{{row[1]}}</span><br>
				In stock<br>
				<a href="/removeFromCart?productId={{row[0]}}">Remove</a>
			</div>
			<div id="itemPrice">
				Rs {{row[2]}}
			</div>
		</div>
		{% endfor %}
		<hr id="seperator">
		<div id="total">
			<span id="subtotal">Subtotal</span> : Rs {{totalPrice}}
		</div>
	</div>
</div>
<a href="/checkout" onclick="bandit.logReward(decision.id, {{totalPrice}});">Proceed to checkout</a>
<br>
<div>
	<h3>Based on your shopping cart we think you'll like:</h2>
		<h3>Context: </h3><p id="contextDiv"></p>
		<h3>Decision: </h3><p id="decisionDiv"></p>
</div>
</body>
</html>

<script>
	var context = bandit.getContext();
	var decision = bandit.getDecision("asdbhasbd1212");
	document.getElementById("contextDiv").innerHTML = JSON.stringify(context);
	document.getElementById("decisionDiv").innerHTML = JSON.stringify(decision);
</script>
